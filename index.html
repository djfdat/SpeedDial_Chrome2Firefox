<!DOCTYPE html>
<html>
<head>

</head>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>SpeedDial Chrome2Firefox</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

<h1>SpeedDial Chrome2Firefox</h1>
<p>Converts Speed Dial 2 for Chrome json to converted_firefox.speeddial for Speed Dial for Firefox</p>

<button id ="btn_convert" type="button" onclick="onClick()" disabled=true>Convert</button>
</br>

<table>
	<th>Input</th>
	<th>Output</th>
	<tr>
		<td><textarea id="input" rows="58" cols="72"></textarea></td>
		<td><textarea id="output" rows="58" cols="72" readonly=true></textarea></td>
	</tr>
</table> 

<script>

const firefox_header = "-----------------------------------------------------------------------\n                       Speed Dial - Dials\n          05/15/2015, 20:32:42 (Sat, 16 May 2015 03:32:42 GMT)\n-----------------------------------------------------------------------\n                         DO NOT EDIT THIS FILE\n-----------------------------------------------------------------------\n"
const firefox_footer = "altLeftClickAction=5\naltMiddleClickAction=3\naltRightClickAction=6\naltShiftShortcutAction=0\naltShiftShortcutMultikey=true\naltShortcutAction=0\naltShortcutMultikey=true\naskBeforeRemovingGroup=true\nbackgroundBrowserHeight=600\nbackgroundBrowserWidth=800\nbuttonOpensInCurrentTab=false\ncacheMode=1\ncaptureDelay=1200\ncaptureTimeout=30000\nclearURLBarOnLoad=true\ncloakEvents=false\ncolorizeTabs=true\ncolumns=5\ncontrolLeftClickAction=3\ncontrolMiddleClickAction=3\ncontrolRightClickAction=6\nctrlAltShiftShortcutAction=0\nctrlAltShiftShortcutMultikey=true\nctrlShiftShortcutAction=2\nctrlShiftShortcutMultikey=true\nctrlShortcutAction=1\nctrlShortcutMultikey=true\ncurrentVersion=0.9.6.17\ndefaultDialJavascript=true\ndefaultRefreshInterval=900\ndisableBackgroundBrowserAuth=true\ndisableBackgroundBrowserJavascript=false\ndisableBackgroundBrowserPlugins=true\nenableCache=true\nenableGroups=true\nerrorWhenTimeout=true\nfirstRunRedirection=true\nflexibleTabBar=false\nfocusContentOnLoad=false\nfocusElement=0\nfocusURLBarOnLoad=true\nheightModifier=100\nheightModifierType=0\nhideThumbnailIcons=false\nhideThumbnailNumbers=false\nignoreFileDrops=true\nignoreRedirects=false\nignoreZeroKey=true\nimageFormat=png\nlastGroup=0\nleftClickAction=1\nloadInLastTab=true\nloadInNewTab=true\nloadInNewWindow=true\nmaximumHeight=-1\nmaximumWidth=2400\nmetaLeftClickAction=3\nmetaMiddleClickAction=3\nmetaRightClickAction=3\nmiddleClickAction=3\nminimumHeight=200\nminimumWidth=200\nmouseOverThumbnailButtons=true\nmouseOverThumbnailButtonsHighlight=true\nmultikeyForSingleDigit=false\nmultikeyOverlayWidthModifier=80\nmultikeySelectWhenComplete=false\nnumBackups=-1\noldResampling=false\nopenExistingFirst=true\nopenOnBlankTab=true\noverrideCtrlNumber=true\npopupOptionsAccess=true\npreScaling=true\nrememberLastGroup=false\nrememberTabLastGroup=true\nreorderDialsAfterGroupDelete=true\nrightClickAction=6\nrows=5\nshiftLeftClickAction=4\nshiftMiddleClickAction=2\nshiftRightClickAction=6\nshowInAreaContextMenu=false\nshowInBookmarksMenu=false\nshowInTabContextMenu=false\nshowThumbnailBackgroundTabButton=false\nshowThumbnailDeassignButton=false\nshowThumbnailEditButton=true\nshowThumbnailNewTabButton=false\nshowThumbnailNewWindowButton=false\nshowThumbnailOpenButton=false\nshowThumbnailReloadButton=true\nsidebarColumns=1\nsidebarThumbnailProportion=1.333\ntabDragSelectDelay=500\nthumbnailDragDropExclude=false\nthumbnailImageHeight=800\nthumbnailImageWidth=800\nthumbnailSequentialUpdate=false\nthumbnailTooltipTitle=true\nthumbnailTooltipURL=true\nurlBarShortcuts=true\nuseGroupNameInTitle=true\nuseIframe=false\nuseJava=false\nuseKeyCapture=false\nuseThemeTabs=true\nwheelScrollAmount=10\nwidthModifier=80\nwidthModifierType=0\nzeroStartsMultiKey=false"

const btn_convert = document.getElementById("btn_convert");
const txt_input = document.getElementById("input");
const txt_output = document.getElementById("output");

main();

function onClick()
{
	convert();
}

function convert()
{
	txt_log.innerHTML = ""

	btn_convert.disabled = true;

	const parsed = JSON.parse(txt_input.value);

	const num_columns = parsed.settings["options.columns"];
	const num_rows = parsed.settings["options.columns"];

	const num_groups = Object.keys(parsed.groups).length;

	var i;
	var j;

	// Start with default header
	txt_output.innerHTML = firefox_header;

	var groups = [];
	
	// Creating group object for home tab
	var group = {};

	group.id = 0;
	group.title = "Home";
	group.dials = [];

	groups.push(group);

	// Parse groups
	for (i = 0; i < Object.keys(parsed.groups).length; i++)
	{
		// Recycle old group object
		group = {};

		group.id = parsed.groups[i].id;
		group.title = parsed.groups[i].title;
		group.dials = [];

		groups.push(group);
	}

	for (i = 0; i < groups.length; i++)
	{
		txt_output.innerHTML += "group-" + (i + 1) + "-columns=" + num_columns + "\n"
		txt_output.innerHTML += "group-" + (i + 1) + "-rows=" + num_rows + "\n"
		txt_output.innerHTML += "group-" + (i + 1) + "-title=" + groups[i].title + "\n"
	}
	txt_output.innerHTML += "numGroups=" + groups.length + "\n"
	
	// dials
	const num_dials = Object.keys(parsed.dials).length;

	var dial;
	var group_index;

	// parse dials
	for (i = 0; i < num_dials; i++)
	{
		group_index = get_group_index(groups, parsed.dials[i].idgroup);

		if (group_index == undefined) continue;

		dial = {};

		dial.label = parsed.dials[i].title
		dial.url = parsed.dials[i].url
		dial.thumbnailurl = parsed.dials[i].thumbnail

		groups[group_index].dials.push(dial);
	}
	
	var dial_id;

	// print dials
	for (i = 0; i < groups.length; i++)
	{
		for (j = 0; j < groups[i].dials.length; j++)
		{
			dial_id = num_columns * num_rows * i + j + 1;

			txt_output.innerHTML += "thumbnail-" + dial_id + "-dynamictitle=false" + "\n"
			txt_output.innerHTML += "thumbnail-" + dial_id + "-format=png" + "\n"
			txt_output.innerHTML += "thumbnail-" + dial_id + "-js=true" + "\n"
			txt_output.innerHTML += "thumbnail-" + dial_id + "-refreshinterval=900" + "\n"
			txt_output.innerHTML += "thumbnail-" + dial_id + "-label=" + groups[i].dials[j].label + "\n"
			txt_output.innerHTML += "thumbnail-" + dial_id + "-url=" + groups[i].dials[j].url + "\n"
			if (groups[i].dials[j].thumbnailurl != "")
			{
				txt_output.innerHTML += "thumbnail-" + dial_id + "-thumbnailurl=" + groups[i].dials[j].thumbnailurl + "\n"
			}
		}
	}

	txt_output.innerHTML += firefox_footer;

	btn_convert.innerHTML = "Success";
	btn_convert.disabled = false;
}

function get_group_index(groups, id_lookup)
{
	for (var i = 0; i < groups.length; i++)
	{
		if (groups[i].id == id_lookup) return i;
	}
}

function main()
{
	btn_convert.disabled = false;
}

</script>

</body>
</html>